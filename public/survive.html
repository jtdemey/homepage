<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Survive</title>
		<link rel="stylesheet" type="text/css" media="screen" href="/survive/survive_look.css" title="Default">
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<script src="//cdn.jsdelivr.net/jquery.color-animation/1/mainfile"></script>
	</head>
<body>
	<div class="survive-content">
		<div class="game-viewport">
			<div class="tickdisplay"></div>
			<div class="mainconsole gameview" id="gameview1">
				<div class="console-grid">
					<div class="line-area"></div>
					<div class="console-info">
						<ul class="console-stats">
							<li class="stat-health">
								<img src="/survive/staticon1.svg" class="stat-icon hp-icon"></img>
								<strong><span class="hp-amt">100</span></strong>
							</li>
							<li class="stat-temp">
								<img src="/survive/staticon2.svg" class="stat-icon temp-icon"></img>
								<strong><span class="temp-amt">100</span></strong>
							</li>
							<li class="stat-sanity">
								<img src="/survive/staticon3.svg" class="stat-icon sanity-icon"></img>
								<strong><span class="sanity-amt">100</span></strong>
							</li>
						</ul>
						<ul class="console-exits">
							<strong><li class="console-exit-dir">OUT:</li></strong>
							<li class="console-exit-name">Woodlands</li>
						</ul>
					</div>
				</div>
				<div class="cl-area">
					<input type="text" name="commandline" class="form-control commandline" placeholder=">>" autofocus></input>
				</div>
			</div>
			<div class="inventory gameview" id="gameview2">
        <div class="igv-header locale-header">
					<h4 class="igv-title locale-title">CAR</h4>
				</div>
				<div class="igv-listarea locale-listarea">
					<ul class="igv-list locale-list">
					
					</ul>
				</div>
				<div class="igv-header inventory-header">
					<h4 class="igv-title inventory-title">INVENTORY</h4>
				</div>
				<div class="igv-listarea inventory-listarea">
					<ul class="igv-list inventory-list">
					
					</ul>
				</div>
				<div class="igv-header crafting-header">
					<h4 class="igv-title crafting-title">CRAFTING</h4>
				</div>
				<div class="igv-listarea crafting-listarea">
					<ul class="igv-list crafting-list">
					
					</ul>
				</div>
			</div>
			<div class="mapview gameview" id="gameview3">
				<div class="map-grid"></div>
			</div>
			<div class="statusview gameview" id="gameview4">
				
			</div>
		</div>
		<div class="nav-tabs">
			<div class="nav-tab home-tab" id="nav-tab1">
				<span class="tab-icon home-icon"><img class="tab-img" src="/survive/tabicon1.svg"></span>
			</div>
			<div class="nav-tab inventory-tab" id="nav-tab2">
				<span class="tab-icon inventory-icon"><img class="tab-img" src="/survive/tabicon2.svg"></span>
			</div>
			<div class="nav-tab map-tab" id="nav-tab3">
				<span class="tab-icon map-icon"><img class="tab-img" src="/survive/tabicon5.svg"></span>
			</div>
			<div class="nav-tab status-tab" id="nav-tab4">
				<span class="tab-icon status-icon"><img class="tab-img" src="/survive/tabicon4.svg"></span>
			</div>
		</div>
	</div>
	<footer class="text-center">
		<h6>Designed by JD</h6>
		<h5>Current build: alpha1.3</h5>
	</footer>
</body>
</html>
<script src="/survive/Parser.js"></script>
<script src="/survive/Player.js"></script>
<script src="/survive/createGame.js"></script>
<script>
$(document).ready(function() {
/*
	GAME NOTES
	-Day cycle represented by darkness of border?
	-Areas
		-Forest
			-Constant temp drain
			-Wabbajack-like predator (Hulking Horror)
				-Drawn to fire/light
				-Fast
				-Telegraphs: howls (far), rustling (medium range), growl (close), roar (adjacent map cell)
			-Day cycle
				-Night = increased difficulty
		-Mansion
			-Deranged hunter (The Hunter)
				-Stays upstairs in locked room until player enters basement
				-Slow
				-Telegraph: heavy footsteps
				-Wields rifle and hunting machete
				-Hard to escape; can use traps
		-Cemetery
			-Weeping wraith (Weeping Demon)
      -Territorial ghoul
	-Character
		-Nameless
		-Inventory
			-Flashlight + some batteries
			-Lighter
		    -Can light fires with tinder
	-Enemies
		-3 difficulties for day 1, 2, and 3+ (more realistic -> more terrifying)
		-Woods
      -Difficulty 1: wolf, owl, dog, wolverine, husk, blue slime, green slime, giant rat
      -Difficulty 2: cougar, mangy bear, zombie, ghoul, red slime, purple slime, hag,
    -Mansion
    -Cemetery
      -Difficulty 1: ghost, ghoul
      -Difficulty 2: spectre, wraith, zombie

*/
  //GLOBALS
  var tick = 0;
  var gameview = 1;
  var gameTime = new Date(1987, 11, 13, 2, 44, 0, 0);
  var displayTime = "Dec 13, 1987 2:44";
  var gameWidth = $('.survive-content').width();
  var tabHeight = $('.nav-tabs').height();
  $('.tickdisplay').text(displayTime);
  $('.mainconsole').show();
  $('.linebox').css({"width": ((gameWidth / 4 * 3) + "px")});
  //DYNAMISM
  $(window).resize(adjustTabs);
  //LISTENERS
  $('.nav-tab').on('mouseenter', function() {
    $(this).stop().animate({backgroundColor: "#330000"}, 300);
  }).on('mouseleave', function() {
    $(this).stop().animate({backgroundColor: "#595959"}, 400);
  }).on('click', function() {
    var tid = $(this).attr("id");
    switchGameview(parseInt(tid.substr(tid.length - 1)));
  });
  //INITIATE
  startClock();
  adjustTabs();
  refreshConsoleExits();
  //I/O
  $('.commandline').on('keydown',function(e) {
    if(e.keyCode == 13) {
      var rawinput = $('.commandline').val();
      rawinput = rawinput.trim();
      $('.commandline').val('');
      var commcode = Parser.parse(rawinput);
    }
  });
  //GAME
  async function updateGame() {
    if(tick < 12) {
      openingRoll(tick);
    } else {
      if(tick % 10 == 0) {
        iterateTime();
        $('.tickdisplay').text(displayTime);
      }
      Player.onTick(tick);
      Player.locale.onTick(tick);
    }
  }
  //CORE FUNCTIONS
  async function startClock() {
    while(tick < 100) {
      updateGame();
      tick = tick + 1;
      await sleep(1000);
      //Cleanup
      var highest = $('p:first').css('bottom');
      if(parseInt(highest) > 1000) {
        $('p:first').remove();
      }
    }
  } 
  async function iterateTime() {
    gameTime.setMinutes(gameTime.getMinutes() + 1);
    switch(gameTime.getMonth()) {
  	  case 0: displayTime = "Jan"; break;
      case 1: displayTime = "Feb"; break;
      case 2: displayTime = "Mar"; break;
      case 3: displayTime = "Apr"; break;
      case 4: displayTime = "May"; break;
      case 5: displayTime = "Jun"; break;
      case 6: displayTime = "Jul"; break;
      case 7: displayTime = "Aug"; break;
      case 8: displayTime = "Sep"; break;
      case 9: displayTime = "Oct"; break;
      case 10: displayTime = "Nov"; break;
      case 11: displayTime = "Dec"; break;
    }
    displayTime = displayTime + " " + gameTime.getDate() + ", " + gameTime.getFullYear() + " " + gameTime.getHours() + ":" + gameTime.getMinutes();
  }
  //UTILITIES
  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
  function switchGameview(tab) {
	$('#gameview' + tab).css({"right": "800px"});
  $('#gameview' + gameview).fadeOut({queue: false, duration: 150}).animate({left: "800px"}, 100, function() {
	  $('#gameview' + gameview).css({"left": "0px"});
	  $('#gameview' + tab).fadeIn({queue: false, duration: 150}).animate({right: "800px"});
	  gameview = tab;
	});
	/**$('#gameview' + gameview).fadeOut({queue: false, duration: 400}).animate({left: "100px"}, 400, function() {
	  gameview = tab;
	  $('#gameview' + gameview).fadeIn({queue: false, duration: 400}).animate({right: "100px"}, 400);
	});**/
  }
});
function executeCommand(comm) {
  switch(comm[0]) {
    case "GO":
      var dir = comm[1];
      changeLocale(dir);
  }
}
function openingRoll(tick) {
  if(tick == 2) { appendLine("A dirt backroad."); }
  if(tick == 3) { appendLine("Caledonia County, Vermont."); }
  if(tick == 4) { appendLine("December 13th, 1987. 2:44AM."); }
  if(tick == 6) { appendLineC("Survive.", "red"); }
  if(tick == 9) { appendLine("The engine stalls."); }
  if(tick == 11) {
    appendLine("Your car comes to a stop.");
    $('.tickdisplay').fadeIn({queue: false, duration: "slow"}).animate({fontSize: "1em"}, 1000);
  }
}
function changeLocale(dir) {
  console.log(dir);
  try {
    for(var i = 0; i < Player.locale.exits.length; i++) {
      if(Player.locale.exits[i].dir == CARDINAL_DIRS[dir]) {
        Player.lastLocale = Player.locale;
        Player.locale = gameMap[Player.locale.exits[i].destination];
        Player.locale.visits += 1;
        appendLine(Player.locale.enterPhrase);
        return;
      }
    }
    appendLineR(["You can't go that way.", "There's nothing in that direction.", "There's something in the way."]);
  } catch(err) {
    appendLineC("!!ERROR: unable to change player locale!!", "red");
  }
  /**try {
    if(Player.locale.exits[CARDINAL_DIRS[dir]] != 0) {
      Player.lastLocale = Player.locale;
      Player.locale = Player.locale.exits[0];
      Player.locale.visits += 1;
      appendLine(Player.locale.enterPhrase);
    } else {
      if(Player.locale.exitPhrases[CARDINAL_DIRS[dir]] != 0) {
        appendLine(Player.locale.exitPhrases[CARDINAL_DIRS[dir]]);
      } else {
       appendLineR(["You can't go that way.", "There's nothing in that direction."]);
      }
    }
  } catch(err) {
    appendLineC("!!ERROR: unable to change player locale!!", "red");
  }**/
}
function refreshConsoleExits() {
	$('.console-exits li').remove();
	for(var i = 0; i < Player.locale.exits.length; i++) {
		if(Player.locale.exits[i] != 0) {
			var dirn = CARDINAL_FULL[i];
			var nameElement = $('<strong><li class="console-exit-dir">' + dirn + '</li></strong>');
			var exitLocale = $('<li class="console-exit-name">' + gameMap[Player.locale.exits[i]].display + '</li>');
			$('.console-exits').append(nameElement).append(exitLocale);
		}
	}
}
function adjustTabs() {
  var fw = $('.nav-tabs').width();
  var fh = $('.nav-tabs').height();
  $('.nav-tab').css({"width": ((fw / 4 - 3) + "px"), "height": (fh + "px")});
  //$('.tab-img').css({"margin-top": ((fh / 2 - 50) + "px")});
}
</script>
